var auth=function(){return{checkAuth:function(){return localStorage.getItem("access_token")?!0:!1},getAccessToken:function(){return localStorage.getItem("access_token")}}}(),baseMixin={data:function(){return{mainHub:$.connection.mainHub,loaded:!1,alert:$("#alert")}},ready:function(){var $this=this;$.connection.hub.qs={authorization:auth.getAccessToken()};$.connection.hub.logging=!0;$.connection.hub.connectionSlow(function(){$this.showAlert("We are currently experiencing difficulties with the SignalR connection")});$.connection.hub.error(function(error){error.context&&error.context.status===401?($this.showAlert("Session expired, please login."),$this.$dispatch("do-logout")):$this.showAlert(error)});$.connection.hub.reconnected(function(){$this.showAlert("Reconnected to SignalR hub, transport "+$.connection.hub.transport.name)});ifvisible.on("wakeup",function(){$.connection.hub&&$.connection.hub.state===$.signalR.connectionState.disconnected&&$.connection.hub.start()})},methods:{showAlert:function(message){this.alert.find("p").text(message);this.alert.show()}},filters:{truncate:function(val,len){return val.substring(0,len)},statusGlyph:function(val){return val==="running"?"glyphicon-play":val==="paused"?"glyphicon-pause":val==="restarting"?"glyphicon-refresh":"glyphicon-stop"}}},login=Vue.extend({template:"#login",data:function(){return{credentials:{username:"",password:""},error:""}},ready:function(){var $this=this;localStorage.getItem("access_token")&&localStorage.removeItem("access_token")},methods:{login:function(){var $this=this;Vue.http.options.emulateJSON=!0;this.$http.post(window.location.origin+"/token",this.credentials).then(function(response){var access_token=response.json().access_token;localStorage.setItem("access_token",access_token);$this.$dispatch("on-login");Vue.http.headers.common.Authorization="Bearer "+access_token;router.go("/")},function(response){$this.error=response.body})}},route:{deactivate:function(){}}}),host=Vue.extend({mixins:[baseMixin],template:"#host",data:function(){return{debouncer:null,timer:null,filterCon:"",filterImg:"",filterNet:"",countCon:0,countImg:0,countNet:0,host:null,containers:null,images:null,networks:null}},ready:function(){var $this=this;this.mainHub.client.onContainerEvent=this.onContainerEvent;$.connection.hub.start().done(function(){$this.loadData();$this.loaded=!0})},methods:{loadHost:function(){var $this=this;this.mainHub.server.getHostInfo().then(function(host){$this.host=host})},loadContainers:function(){var $this=this;this.mainHub.server.getContainerList().then(function(containers){$this.containers=containers;$this.countCon=containers.length})},onContainerEvent:function(event){console.log(event);this.debouncer&&clearTimeout(this.debouncer);this.debouncer=setTimeout(this.loadContainers,1e3)},loadImages:function(){var $this=this;this.mainHub.server.getImageList().then(function(images){$this.images=images;$this.countImg=images.length})},loadNetworks:function(){var $this=this;this.mainHub.server.getNetworkList().then(function(networks){$this.networks=networks;$this.countNet=networks.length})},loadData:function(){var $this=this;this.mainHub.server.getHost().then(function(data){$this.host=data.host;$this.containers=data.containers;$this.countCon=data.containers.length;$this.images=data.images;$this.countImg=data.images.length;$this.networks=data.networks;$this.countNet=data.networks.length});this.timer&&clearTimeout(this.timer);this.timer=setTimeout(this.loadData,3e4)}},route:{deactivate:function(){this.timer&&clearTimeout(this.timer);this.debouncer&&clearTimeout(this.debouncer)}}}),container=Vue.extend({mixins:[baseMixin],template:"#container",data:function(){return{id:"",logs:"",memChart:null,mem:"",rxTotal:"",txTotal:"",iorxTotal:"",iotxTotal:"",cpuTime:"",pids:0,timer:null,con:null}},ready:function(){this.id=this.$route.params.id;var $this=this;this.mainHub.client.onContainerEvent=this.onContainerEvent;$.connection.hub.start().done(function(){$this.loadData();$this.loaded=!0})},methods:{loadDetails:function(){var $this=this;this.mainHub.server.getContainerDetails(this.id).then(function(details){details===undefined?$this.showAlert("Container not found"):($this.con=details,$this.con.State=="running"?$this.loadStats():$this.mem=null)})},loadLogs:function(){var $this=this;this.mainHub.server.getContainerLogs(this.id,1e3).then(function(logs){$this.logs=logs})},loadStats:function(){var $this=this;this.mainHub.server.getContainerStats(this.id).then(function(data){data&&($this.mem=data.memory.label,$this.rxTotal=data.network.labelrx,$this.txTotal=data.network.labeltx,$this.iorxTotal=data.io.labelrx,$this.iotxTotal=data.io.labeltx,$this.pids=data.pids,$this.cpuTime=data.cpuTime)})},loadData:function(){this.loadDetails();this.loadLogs();this.timer&&clearTimeout(this.timer);this.timer=setTimeout(this.loadData,3e4)},lineGraph:function(){Chart.defaults.global.responsive=!0;Chart.defaults.global.maintainAspectRatio=!0;Chart.defaults.global.legend.display=!1;var ctx=$("#lineChart"),options={tooltips:{enabled:!0,mode:"single",callbacks:{label:function(){return"Memory"}}},scales:{xAxes:[{gridLines:{display:!1},ticks:{display:!1}}],yAxes:[{ticks:{min:0}}]}};this.memChart=new Chart(ctx,{type:"line",data:{labels:[],datasets:[{label:"Memory",fill:!0,backgroundColor:"rgba(15,80,136,0.4)",pointBorderColor:"#fff",pointBackgroundColor:"rgba(15,80,136,1)",pointHoverBackgroundColor:"rgba(57,174,225,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointBorderWidth:2,pointRadius:5,data:[],spanGaps:!0}]},options:options})}},route:{deactivate:function(){this.timer&&clearTimeout(this.timer)}}}),router=new VueRouter({history:!0,mode:"html5",linkActiveClass:"active",transitionOnLoad:!0,root:"/"}),app;router.map({"/":{component:{template:"",ready:function(){this.$route.router.go("/host")}},name:"home",title:"Home"},"/login":{component:login,name:"login",title:"Login"},"/host":{component:host,name:"host",title:"Host",auth:!0},"/container/:id":{component:container,name:"container",title:"Container details",auth:!0},"/about":{component:{template:"#about"},name:"about",title:"About"}});router.beforeEach(function(transition){transition.to.auth&&!auth.checkAuth()?transition.redirect("/login"):transition.next()});app=Vue.extend({data:function(){return{alert:$("#alert"),authenticated:!1}},ready:function(){this.authenticated=auth.checkAuth();this.authenticated&&(Vue.http.headers.common.Authorization="Bearer "+auth.getAccessToken())},methods:{logout:function(){localStorage.removeItem("access_token");this.authenticated=!1;this.$route.router.go("/login")},showAlert:function(message){this.alert.find("p").text(message);this.alert.show()},closeAlert:function(){this.alert.hide()}},events:{"on-login":function(){this.authenticated=!0},"do-logout":function(){this.logout()}}});router.start(app,"html");